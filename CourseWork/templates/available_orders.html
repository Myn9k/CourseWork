{% extends 'base.html' %}
{% block title %}–°–≤–æ–±–æ–¥–Ω—ã–µ –∑–∞–∫–∞–∑—ã{% endblock %}

{% block content %}
<div class="container">
    <h2 class="my-4">üöö –°–≤–æ–±–æ–¥–Ω—ã–µ –∑–∞–∫–∞–∑—ã</h2>

    {% if orders %}
        <table class="table">
            <thead>
                <tr>
                    <th>‚Ññ –ó–∞–∫–∞–∑–∞</th>
                    <th>–ê–¥—Ä–µ—Å</th>
                    <th>–°—É–º–º–∞</th>
                    <th>–î–µ–π—Å—Ç–≤–∏–µ</th>
                </tr>
            </thead>
            <tbody>
                {% for order in orders %}
                <tr>
                    <td>#{{ order.id }}</td>
                    <td>
                        {% if order.address %}
                            {{ order.address.address }}  <!-- –ê–¥—Ä–µ—Å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
                        {% else %}
                            {{ order.guest_address }}  <!-- –ê–¥—Ä–µ—Å –≥–æ—Å—Ç—è -->
                        {% endif %}
                    </td>
                    <td>{{ order.total_price }} —Ä—É–±.</td>
                    <td>
                        <button class="btn btn-primary take-order" data-order-id="{{ order.id }}">
                            –í–∑—è—Ç—å –≤ —Ä–∞–±–æ—Ç—É
                        </button>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    {% else %}
        <p>–ù–µ—Ç —Å–≤–æ–±–æ–¥–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤.</p>
    {% endif %}
</div>

<script>
    document.querySelectorAll(".take-order").forEach(button => {
        button.addEventListener("click", function () {
            let orderId = this.dataset.orderId;
            let button = this;

            fetch(`/courier/orders/take/${orderId}/`, {
                method: "POST",
                headers: {"X-CSRFToken": "{{ csrf_token }}"},
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert(data.message);
                    button.closest("tr").remove();
                } else {
                    alert("–û—à–∏–±–∫–∞! –í–æ–∑–º–æ–∂–Ω–æ, –∑–∞–∫–∞–∑ —É–∂–µ –≤–∑—è—Ç. –û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É");
                }
            });
        });
    });
</script>
{% endblock %}
